function f_tcalGetHTML(e){var t=f_tcalGetInputs(true);if(!t)return;var n=A_TCALCONF.cssprefix,r=A_TCALCONF.format;var i=f_tcalParseDate(A_TCALCONF.today,A_TCALCONF.format);if(!i)i=f_tcalResetTime(new Date);var s=f_tcalParseDate(t.value,r);if(!s)s=f_tcalParseDate(A_TCALCONF.selected,A_TCALCONF.format);if(!s)s=new Date(i);e=e?f_tcalResetTime(e):new Date(s);var o=new Date(e);o.setDate(1);o.setDate(1-(7+o.getDay()-A_TCALCONF.weekstart)%7);var u,a='<table id="'+n+'Controls"><tbody><tr>'+(A_TCALCONF.yearscroll?'<td id="'+n+'PrevYear" '+f_tcalRelDate(e,-1,"y")+' title="'+A_TCALCONF.prevyear+'"></td>':"")+'<td id="'+n+'PrevMonth"'+f_tcalRelDate(e,-1)+' title="'+A_TCALCONF.prevmonth+'"></td><th>'+A_TCALCONF.months[e.getMonth()]+" "+e.getFullYear()+'</th><td id="'+n+'NextMonth"'+f_tcalRelDate(e,1)+' title="'+A_TCALCONF.nextmonth+'"></td>'+(A_TCALCONF.yearscroll?'<td id="'+n+'NextYear"'+f_tcalRelDate(e,1,"y")+' title="'+A_TCALCONF.nextyear+'"></td>':"")+'</tr></tbody></table><table id="'+n+'Grid"><tbody><tr>';for(var f=0;f<7;f++)a+="<th>"+A_TCALCONF.weekdays[(A_TCALCONF.weekstart+f)%7]+"</th>";a+="</tr>";var l,c,h=new Date(o);while(h.getMonth()==e.getMonth()||h.getMonth()==o.getMonth()){a+="<tr>";for(var p=0;p<7;p++){u=[];l=h.getDate();c=h.getMonth();if(h.getMonth()!=e.getMonth())u[u.length]=n+"OtherMonth";if(h.getDay()==0||h.getDay()==6)u[u.length]=n+"Weekend";if(h.valueOf()==i.valueOf())u[u.length]=n+"Today";if(h.valueOf()==s.valueOf())u[u.length]=n+"Selected";a+="<td"+f_tcalRelDate(h)+(u.length?' class="'+u.join(" ")+'">':">")+l+"</td>";h.setDate(++l)}a+="</tr>"}a+="</tbody></table>";return a}function f_tcalRelDate(e,t,n){var n=n=="y"?"FullYear":"Month";var r=new Date(e);if(t){r["set"+n](e["get"+n]()+t);if(r.getDate()!=e.getDate())r.setDate(0)}return' onclick="f_tcalUpdate('+r.valueOf()+(t?",1":"")+')"'}function f_tcalResetTime(e){e.setMilliseconds(0);e.setSeconds(0);e.setMinutes(0);e.setHours(12);return e}function f_tcalCancel(){var e=A_TCALCONF.cssprefix;var t=document.getElementById(e);if(t)t.style.visibility="";var n=f_tcalGetInputs();for(var r=0;r<n.length;r++)f_tcalRemoveClass(n[r],e+"Active")}function f_tcalUpdate(e,t){var n=f_tcalGetInputs(true);if(!n)return;d_date=new Date(e);var r=A_TCALCONF.cssprefix;if(t){var i=document.getElementById(r);if(!i||i.style.visibility!="visible")return;i.innerHTML=f_tcalGetHTML(d_date,n)}else{n.value=f_tcalGenerateDate(d_date,A_TCALCONF.format);f_tcalCancel()}}function f_tcalOnClick(){var e=A_TCALCONF.cssprefix;var t=e+"Active";var n=f_tcalHasClass(this,t);f_tcalCancel();if(n)return;f_tcalAddClass(this,t);var r=f_getPosition(this,"Left"),i=f_getPosition(this,"Top")+this.offsetHeight;var s=document.getElementById(e);if(!s){s=document.createElement("div");s.onselectstart=function(){return false};s.id=e;document.getElementsByTagName("body").item(0).appendChild(s)}s.innerHTML=f_tcalGetHTML(null);s.style.top=i+"px";s.style.left=r+this.offsetWidth-s.offsetWidth+"px";s.style.visibility="visible"}function f_tcalParseDate(e,t){if(!e)return;var n,r="^",i={},s,o=0;for(var u=0;u<t.length;u++){n=t.charAt(u);if(A_TCALTOKENS_IDX[n]){i[n]=++o;r+="("+A_TCALTOKENS_IDX[n]["r"]+")"}else if(n==" ")r+="\\s";else r+=(n.match(/[\w\d]/)?"":"\\")+n}var a=new RegExp(r+"$");if(!e.match(a))return;var f,l=f_tcalResetTime(new Date);l.setDate(1);for(u=0;u<A_TCALTOKENS.length;u++){n=A_TCALTOKENS[u]["t"];if(!i[n])continue;f=RegExp["$"+i[n]];l=A_TCALTOKENS[u]["p"](l,f)}return l}function f_tcalGenerateDate(e,t){var n,r="";for(var i=0;i<t.length;i++){n=t.charAt(i);r+=A_TCALTOKENS_IDX[n]?A_TCALTOKENS_IDX[n]["g"](e):n}return r}function f_tcalGetInputs(e){var t=document.getElementsByTagName("input"),r,i,s=[];for(n=0;n<t.length;n++){r=t[n];if(!r.type||r.type!="text")continue;if(!f_tcalHasClass(r,"tcal"))continue;if(e&&f_tcalHasClass(r,A_TCALCONF.cssprefix+"Active"))return r;s[s.length]=r}return e?null:s}function f_tcalHasClass(e,t){var n=e.className;if(!n)return false;var r=n.split(" ");for(var i=0;i<r.length;i++)if(r[i]==t)return true;return false}function f_tcalAddClass(e,t){if(f_tcalHasClass(e,t))return;var n=e.className;e.className=(n?n+" ":"")+t}function f_tcalRemoveClass(e,t){var n=e.className;if(!n||n.indexOf(t)==-1)return false;var r=n.split(" "),i=[];for(var s=0;s<r.length;s++){if(r[s]==t)continue;i[i.length]=r[s]}e.className=i.join(" ");return true}function f_getPosition(e,t){var n=0,r,i=e;while(i){r=i["offset"+t];n+=r;i=i.offsetParent}i=e;while(i!=document.body){r=i["scroll"+t];if(r&&i.style.overflow=="scroll")n-=r;i=i.parentNode}return n}function f_tcalInit(){if(!document.getElementsByTagName)return;var e,t=f_tcalGetInputs();for(var n=0;n<t.length;n++){e=t[n];e.onclick=f_tcalOnClick;f_tcalAddClass(e,A_TCALCONF.cssprefix+"Input")}window.A_TCALTOKENS_IDX={};for(n=0;n<A_TCALTOKENS.length;n++)A_TCALTOKENS_IDX[A_TCALTOKENS[n]["t"]]=A_TCALTOKENS[n]}function f_tcalAddOnload(e){if(document.addEventListener){window.addEventListener("load",e,false)}else if(window.attachEvent){window.attachEvent("onload",e)}else{var t=window.onload;if(typeof window.onload!="function"){window.onload=e}else{window.onload=function(){t();e()}}}}var A_TCALCONF={cssprefix:"tcal",months:["January","February","March","April","May","June","July","August","September","October","November","December"],weekdays:["Su","Mo","Tu","We","Th","Fr","Sa"],longwdays:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],yearscroll:true,weekstart:0,prevyear:"Previous Year",nextyear:"Next Year",prevmonth:"Previous Month",nextmonth:"Next Month",format:"m/d/Y"};var A_TCALTOKENS=[{t:"Y",r:"19\\d{2}|20\\d{2}",p:function(e,t){e.setFullYear(Number(t));return e},g:function(e){var t=e.getFullYear();return t}},{t:"m",r:"0?[1-9]|1[0-2]",p:function(e,t){e.setMonth(Number(t)-1);return e},g:function(e){var t=e.getMonth()+1;return(t<10?"0":"")+t}},{t:"F",r:A_TCALCONF.months.join("|"),p:function(e,t){for(var n=0;n<12;n++)if(A_TCALCONF.months[n]==t){e.setMonth(n);return e}},g:function(e){return A_TCALCONF.months[e.getMonth()]}},{t:"d",r:"0?[1-9]|[12][0-9]|3[01]",p:function(e,t){e.setDate(Number(t));if(e.getDate()!=t)e.setDate(0);return e},g:function(e){var t=e.getDate();return(t<10?"0":"")+t}},{t:"j",r:"0?[1-9]|[12][0-9]|3[01]",p:function(e,t){e.setDate(Number(t));if(e.getDate()!=t)e.setDate(0);return e},g:function(e){var t=e.getDate();return t}},{t:"l",r:A_TCALCONF.longwdays.join("|"),p:function(e,t){return e},g:function(e){return A_TCALCONF.longwdays[e.getDay()]}},{t:"S",r:"st|nd|rd|th",p:function(e,t){return e},g:function(e){n_date=e.getDate();if(n_date%10==1&&n_date!=11)return"st";if(n_date%10==2&&n_date!=12)return"nd";if(n_date%10==3&&n_date!=13)return"rd";return"th"}}];f_tcalAddOnload(f_tcalInit)